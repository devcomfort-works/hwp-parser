name: Deploy to Hugging Face Spaces

on:
  push:
    branches: [main]
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          lfs: true

      - name: Prepare deployment directory
        run: |
          mkdir deploy_dist
          
          # 1. ì†ŒìŠ¤ ì½”ë“œ ë° ì„¤ì • ë³µì‚¬
          cp -r src deploy_dist/
          cp pyproject.toml deploy_dist/
          cp LICENSE deploy_dist/
          
          # 2. app.py ë°°ì¹˜ (ì§„ìž…ì )
          cp src/hwp_parser/web/app.py deploy_dist/app.py
          
          # 3. ì˜ì¡´ì„± ì„¤ì¹˜ ì„¤ì • (í˜„ìž¬ íŒ¨í‚¤ì§€ ì„¤ì¹˜)
          echo "." > deploy_dist/requirements.txt
          
          # 4. Space ì „ìš© README.md ìƒì„± (ë©”íƒ€ë°ì´í„° ì„¤ì •)
          echo "---" > deploy_dist/README.md
          echo "title: HWP Parser" >> deploy_dist/README.md
          echo "emoji: ðŸ“„" >> deploy_dist/README.md
          echo "colorFrom: blue" >> deploy_dist/README.md
          echo "colorTo: indigo" >> deploy_dist/README.md
          echo "sdk: gradio" >> deploy_dist/README.md
          echo "sdk_version: 4.16.0" >> deploy_dist/README.md
          echo "app_file: app.py" >> deploy_dist/README.md
          echo "pinned: false" >> deploy_dist/README.md
          echo "---" >> deploy_dist/README.md
          echo "" >> deploy_dist/README.md
          # ì›ë³¸ README ë‚´ìš© ì´ì–´ë¶™ì´ê¸°
          cat README.md >> deploy_dist/README.md

      - name: Push to Hub
        uses: nateraw/huggingface-sync-action@v1
        with:
          github_repo_id: devcomfort-works/hwp-parser
          huggingface_repo_id: devcomfort/hwp-parser
          hf_token: ${{ secrets.HF_TOKEN }}
          repo_type: space
          space_sdk: gradio
          subdirectory: deploy_dist
